import groovy.sql.Sql;
import java.sql.Driver;
import jenkins.model.*;

def creds = com.cloudbees.plugins.credentials.CredentialsProvider.lookupCredentials(
  com.cloudbees.plugins.credentials.common.StandardUsernameCredentials.class, Jenkins.instance, null, null ).find{
    it.id == 'postgresql'
  }
def result = []
def driver = Class.forName('org.postgresql.Driver').newInstance() as Driver 
def props = new Properties()
props.setProperty("user","${creds.username}") 
props.setProperty("password", "${creds.password}")
def conn = driver.connect("jdbc:postgresql://${POSTHRESQL_NODE}:5432/runs", props) 
def sql = new Sql(conn)
def id = 0
def rows = sql.rows("select max(id) from truns").each { row ->
     id = ("$row.max") as Integer
}
def res = id +1
result.add(res.toString()+":selected:disabled")
return result